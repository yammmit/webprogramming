generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  uid       String   @unique               // Firebase UID
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  groups    GroupMember[]
  tasks     Task[]       @relation("UserTasks")

  // ğŸ”¥ ì¶”ê°€: ì‚¬ìš©ìê°€ ownerì¸ ê·¸ë£¹ë“¤
  ownedGroups Group[]
}

model Group {
  id        Int      @id @default(autoincrement())
  name      String
  ownerId   Int
  createdAt DateTime @default(now())

  owner     User         @relation(fields: [ownerId], references: [id])
  members   GroupMember[]
  tasks     Task[]

  // ğŸ”¥ ì¶”ê°€: ì´ˆëŒ€ í…Œì´ë¸”ê³¼ì˜ ë°˜ëŒ€ í•„ë“œ
  invitations Invitation[]
}

model GroupMember {
  id        Int      @id @default(autoincrement())
  userId    Int
  groupId   Int
  role      String   @default("member")
  joinedAt  DateTime @default(now())

  user      User   @relation(fields: [userId], references: [id])
  group     Group  @relation(fields: [groupId], references: [id])

  @@unique([userId, groupId])
}

model Task {
  id          Int      @id @default(autoincrement())
  groupId     Int
  assignedTo  Int?
  title       String
  description String?
  isDone      Boolean  @default(false)
  dueDate     DateTime?
  createdAt   DateTime @default(now())

  group       Group    @relation(fields: [groupId], references: [id])
  assignee    User?    @relation("UserTasks", fields: [assignedTo], references: [id])
}

model Invitation {
  id        Int      @id @default(autoincrement())
  groupId   Int
  email     String
  token     String   @unique
  createdAt DateTime @default(now())
  used      Boolean  @default(false)

  group     Group    @relation(fields: [groupId], references: [id])
}